# Think 标签支持功能

## 功能概述

本功能添加了对深度思考类型大模型的支持，能够自动清理模型返回结果中的 `<think></think>` 标签内容，确保用户只看到实际的翻译结果。

## 功能特性

- ✅ **自动检测和清理**: 智能检测模型响应中的 `<think></think>` 标签
- ✅ **性能优化**: 只有检测到think标签时才进行清理处理
- ✅ **多标签支持**: 支持清理多个think标签
- ✅ **嵌套结构支持**: 支持复杂的多行和嵌套think标签结构
- ✅ **格式保持**: 自动清理多余空行，保持内容格式整洁
- ✅ **日志记录**: 详细记录think标签的检测和清理过程

## 支持的模型

| 模型类型 | 支持状态 | 说明 |
|---------|---------|------|
| DeepSeek | ✅ 完全支持 | DeepSeek模型支持深度思考功能 |
| OpenAI | ⚪ 自动适配 | 标准OpenAI模型通常不包含think标签 |
| 其他模型 | ✅ 自动适配 | 自动检测和清理think标签 |

## 工作原理

1. **请求发送**: 向大模型API发送翻译请求
2. **响应接收**: 接收模型返回的原始响应
3. **标签检测**: 使用正则表达式检测是否包含 `<think></think>` 标签
4. **内容清理**: 如果检测到think标签，自动移除标签及其内容
5. **格式优化**: 清理多余空行，保持内容格式整洁
6. **日志记录**: 记录清理过程，便于调试和监控

## 示例

### 原始模型响应
```
<think>
我需要分析这个字幕的上下文
考虑语言的自然表达方式
确保翻译准确且符合语境
</think>

这是翻译后的字幕内容
保持原有的时间戳格式
```

### 清理后的结果
```
这是翻译后的字幕内容
保持原有的时间戳格式
```

## 技术实现

### 核心函数

#### `removeThinkTags(content: string): string`
清理内容中的think标签
- **参数**: `content` - 原始内容
- **返回**: 清理后的内容

#### `hasThinkTags(content: string): boolean`
检测内容是否包含think标签
- **参数**: `content` - 要检测的内容
- **返回**: 是否包含think标签

### 集成位置

功能集成在 `BaseTranslator` 类的 `translateFragment` 方法中，确保所有翻译器子类都能受益。

## 配置说明

功能默认启用，无需额外配置。系统会自动检测模型响应中的think标签并进行清理。

## 日志输出

当检测到think标签时，系统会在控制台和错误日志中记录以下信息：
- 检测到think标签的提示
- 清理前的原始内容
- 清理后的最终内容

## 测试功能

可以使用 `testRemoveThinkTags()` 函数来测试think标签清理功能：

```typescript
import { testRemoveThinkTags } from './utils';
testRemoveThinkTags();
```

## 性能说明

- **智能检测**: 使用 `hasThinkTags()` 函数预检测，避免不必要的清理操作
- **高效正则**: 使用优化的正则表达式，支持复杂嵌套结构
- **最小影响**: 对不包含think标签的内容几乎无性能影响

## 兼容性

- ✅ 向后兼容：不影响现有功能
- ✅ 跨平台：支持所有支持的操作系统
- ✅ 多模型：适配各种大模型API 