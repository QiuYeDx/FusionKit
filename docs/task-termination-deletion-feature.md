# 【P1】单条任务的终止与删除功能

## 功能概述

本功能为字幕翻译器增加了对单条任务的终止与删除操作，提升了用户对任务队列的控制能力。

## 实现内容

### 1. 后端功能
- **任务取消机制**：已存在的IPC通信机制 `cancel-translation`
- **任务状态管理**：通过AbortController实现任务的优雅取消
- **错误处理**：正确处理被取消任务的状态转换

### 2. 前端Store更新

#### 新增方法
- `cancelTask(fileName: string)`: 取消正在执行或等待中的任务
- `deleteTask(fileName: string)`: 删除任务（支持所有状态的任务）

#### 功能特性
- **智能并发管理**：取消任务时自动启动等待队列中的下一个任务
- **状态同步**：取消的任务会转为失败状态，便于用户重试
- **用户反馈**：提供相应的Toast提示信息

### 3. UI界面改进

#### 任务操作按钮
- **开始按钮**：仅对未开始的任务显示（蓝色圆形按钮）
- **重试按钮**：仅对失败任务显示（灰色圆形按钮）
- **取消按钮**：对进行中和等待中任务显示（黄色圆形按钮）
- **删除按钮**：对所有状态任务显示（红色圆形按钮）

#### 交互设计
- 使用DaisyUI的tooltip组件提供操作提示
- 采用圆形小按钮设计，节省空间
- 颜色编码符合用户直觉

### 4. 国际化支持

增加了新的翻译键：
- `subtitle:translator.actions.start`: 开始任务
- `subtitle:translator.actions.retry`: 重试任务 
- `subtitle:translator.actions.cancel`: 取消任务
- `subtitle:translator.actions.delete`: 删除任务

支持语言：中文、英文、日文

## 技术细节

### 任务取消流程
1. 用户点击取消按钮
2. 前端通过IPC发送`cancel-translation`消息
3. 后端调用AbortController.abort()
4. 任务状态更新为失败（CANCELED）
5. 自动启动等待队列中的下一个任务

### 任务删除流程
1. 用户点击删除按钮
2. 从所有任务队列中移除该任务
3. 显示删除成功的Toast提示

### 状态管理
- **NOT_STARTED**: 显示开始和删除按钮
- **WAITING**: 显示取消和删除按钮
- **PENDING**: 显示取消和删除按钮
- **RESOLVED**: 显示删除按钮
- **FAILED**: 显示重试和删除按钮

## 文件修改清单

### 核心文件
1. `src/store/tools/subtitle/useSubtitleTranslatorStore.ts`
   - 新增cancelTask和deleteTask方法
   - 更新接口定义

2. `src/pages/Tools/Subtitle/SubtitleTranslator/index.tsx`
   - 新增取消和删除按钮
   - 优化任务操作UI布局
   - 导入新的图标组件

### 国际化文件
3. `src/locales/zh/subtitle.json`
4. `src/locales/en/subtitle.json` 
5. `src/locales/ja/subtitle.json`
   - 新增actions节点及相关翻译

## 使用说明

### 取消任务
- 适用于：正在执行的任务和等待队列中的任务
- 操作：点击黄色的X图标按钮
- 结果：任务被取消并标记为失败状态，可以重试

### 删除任务
- 适用于：所有状态的任务
- 操作：点击红色的垃圾桶图标按钮
- 结果：任务从队列中完全移除

### 自动队列管理
- 当取消或完成任务时，系统会自动检查等待队列
- 如果有等待的任务且并发数未满，会自动启动下一个任务
- 保持最佳的任务执行效率

## 测试建议

1. **功能测试**
   - 添加多个任务到队列
   - 测试各种状态下的取消和删除操作
   - 验证自动队列管理功能

2. **UI测试**
   - 检查按钮在不同状态下的显示
   - 验证tooltip提示文字
   - 测试多语言环境下的显示

3. **边界测试**
   - 取消最后一个任务
   - 删除正在执行的任务
   - 并发限制达到时的行为验证

## 后续优化建议

1. **批量操作**：考虑增加批量取消/删除功能
2. **确认对话框**：为删除操作添加确认对话框
3. **任务恢复**：考虑实现删除任务的恢复功能
4. **操作日志**：记录用户的任务操作历史